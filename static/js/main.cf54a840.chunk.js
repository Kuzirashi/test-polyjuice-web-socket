(this["webpackJsonpweb-socket-balance-tracking"]=this["webpackJsonpweb-socket-balance-tracking"]||[]).push([[0],{189:function(e){e.exports=JSON.parse('{"abi":[{"constant":true,"inputs":[],"name":"name","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"guy","type":"address"},{"name":"wad","type":"uint256"}],"name":"approve","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"totalSupply","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"src","type":"address"},{"name":"dst","type":"address"},{"name":"wad","type":"uint256"}],"name":"transferFrom","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"wad","type":"uint256"}],"name":"withdraw","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"decimals","outputs":[{"name":"","type":"uint8"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"balanceOf","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"symbol","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"dst","type":"address"},{"name":"wad","type":"uint256"}],"name":"transfer","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[],"name":"deposit","outputs":[],"payable":true,"stateMutability":"payable","type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"},{"name":"","type":"address"}],"name":"allowance","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"payable":true,"stateMutability":"payable","type":"fallback"},{"anonymous":false,"inputs":[{"indexed":true,"name":"src","type":"address"},{"indexed":true,"name":"guy","type":"address"},{"indexed":false,"name":"wad","type":"uint256"}],"name":"Approval","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"src","type":"address"},{"indexed":true,"name":"dst","type":"address"},{"indexed":false,"name":"wad","type":"uint256"}],"name":"Transfer","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"dst","type":"address"},{"indexed":false,"name":"wad","type":"uint256"}],"name":"Deposit","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"src","type":"address"},{"indexed":false,"name":"wad","type":"uint256"}],"name":"Withdrawal","type":"event"}]}')},426:function(e,t,n){},440:function(e,t){},442:function(e,t){},456:function(e,t){},458:function(e,t){},466:function(e,t){},468:function(e,t){},529:function(e,t){},558:function(e,t){},560:function(e,t){},562:function(e,t){},566:function(e,t){},682:function(e,t){},684:function(e,t){},691:function(e,t){},692:function(e,t){},710:function(e,t){},74:function(e){e.exports=JSON.parse('{"nervos":{"ckb":{"url":"https://testnet.ckb.dev"},"godwoken":{"rpcUrl":"https://godwoken-testnet-web3-rpc.ckbapp.dev","wsUrl":"ws://godwoken-testnet-web3-rpc.ckbapp.dev/ws","networkId":"0x116e1"},"indexer":{"url":"https://testnet.ckb.dev/indexer"},"rollupTypeHash":"0x4cc2e6526204ae6a2e8fcf12f7ad472f41a1606d5b9624beebd215d780809f6a","rollupTypeScript":{"codeHash":"0x5c365147bb6c40e817a2a53e0dec3661f7390cc77f0c02db138303177b12e9fb","hashType":"type","args":"0x213743d13048e9f36728c547ab736023a7426e15a3d7d1c82f43ec3b5f266df2"},"ethAccountLockCodeHash":"0xdeec13a7b8e100579541384ccaf4b5223733e4a5483c3aec95ddc4c1d5ea5b22","depositLockScriptTypeHash":"0x5a2506bb68d81a11dcadad4cb7eae62a17c43c619fe47ac8037bc8ce2dd90360","portal_wallet_lock_hash":"0x58c5f491aba6d61678b7cf7edf4910b1f5e00ec0cde2f42e0abb4fd9aff25a63"},"ethereum":{"networkId":"0x4","fallback":{"rpcUrl":"","infura":{"apiKey":"808015861a3048648a41e56b23038945"}}}}')},807:function(e,t){},817:function(e,t){},823:function(e,t){},830:function(e,t){},868:function(e,t,n){"use strict";n.r(t);var a=n(21),s=n.n(a),o=n(406),c=n.n(o),l=(n(426),n(407)),i=n(146);let u;!function(e){e.requestAccounts="eth_requestAccounts",e.requestWallet="wallet_requestPermissions",e.watchAsset="wallet_watchAsset",e.switchNetwork="wallet_switchEthereumChain",e.accountsChanged="accountsChanged"}(u||(u={}));var r=n(22);const d=e=>{let{onConnect:t}=e;const[n,a]=s.a.useState("Click here to install MetaMask!"),[o,c]=s.a.useState(!1),[l,d]=s.a.useState([]),p=s.a.useRef(),b=e=>{const[n]=e;d(e),t(n)};s.a.useEffect((()=>{p.current||(p.current=new i.a)}),[]),s.a.useEffect((()=>{var e;(console.log("effect"),i.a.isMetaMaskInstalled())&&(console.log("metamask installed"),l.length>0?(console.log("connect"),a("Connected"),c(!0),null===(e=p.current)||void 0===e||e.stopOnboarding()):(console.log("connected"),a("Connect"),c(!1)))}),[l]),s.a.useEffect((()=>{if(i.a.isMetaMaskInstalled())return window.ethereum.request({method:u.requestAccounts}).then(b),window.ethereum.on(u.accountsChanged,b),()=>{window.ethereum.off(u.accountsChanged,b)}}),[]);return Object(r.jsx)("button",{disabled:o,onClick:()=>{var e;i.a.isMetaMaskInstalled()?window.ethereum.request({method:u.requestAccounts}).then((e=>b(e))):null===(e=p.current)||void 0===e||e.startOnboarding()},children:n})},p=e=>{let{label:t,onClick:n,onChange:a,value:s,placeholder:o}=e;return Object(r.jsxs)("div",{style:{display:"flex",border:"1px solid black",justifyContent:"space-between",padding:8},children:[Object(r.jsx)("input",{onChange:e=>{const t=Number(e.target.value);a(t)},value:s,placeholder:o}),Object(r.jsx)("button",{onClick:n,children:t})]})};var b=n(415),f=n(416),y=n(74),m=n(67),h=n.n(m),w=n(189);const v=new l.AddressTranslator;var g=()=>{const[e,t]=s.a.useState(null),[n,o]=s.a.useState(null),[c,l]=s.a.useState(null),[i,u]=s.a.useState(null),[m,g]=s.a.useState(null),[j,x]=s.a.useState(null),[k,O]=s.a.useState(0),[C,S]=s.a.useState(null),B=(e=>{const[t,n]=Object(a.useState)(null),s={timeout:3e4,clientConfig:{maxReceivedFrameSize:1e8,maxReceivedMessageSize:1e8,keepalive:!0,keepaliveInterval:6e4},reconnect:{auto:!0,delay:5e3,maxAttempts:5,onTimeout:!1}};return Object(a.useEffect)((()=>{if(e){const e=new b.PolyjuiceWebsocketProvider(y.nervos.godwoken.wsUrl,{rollupTypeHash:y.nervos.rollupTypeHash,ethAccountLockCodeHash:y.nervos.ethAccountLockCodeHash,web3Url:y.nervos.godwoken.rpcUrl},s);e.setMultiAbi([w.abi]);const t=new h.a(e);n(t)}}),[e]),t})(e),M=(e=>{const[t,n]=Object(a.useState)(null);return Object(a.useEffect)((()=>{if(e){const e=new f.PolyjuiceWebsocketProvider({rollupTypeHash:y.nervos.rollupTypeHash,ethAccountLockCodeHash:y.nervos.ethAccountLockCodeHash,web3Url:y.nervos.godwoken.rpcUrl},y.nervos.godwoken.wsUrl);e.on("block",(()=>console.log("block new"))),n(e)}}),[e]),t})(e),A=((e,t)=>{const[n,s]=Object(a.useState)();return Object(a.useEffect)((()=>{if(t){const n=new t.eth.Contract(w.abi,e);s(n),console.log("erc20 connected",n)}}),[e,t]),n})("0x0815b0d4e58c8e707a85e774c37cab65480f66e9",B);B&&B.eth.subscribe("newBlockHeaders",(async(e,t)=>{e?console.error(e):o(t.number)})),M&&(console.log("ethers",M),M.on("block",(e=>{console.log("ethers New Block from ethers:",e)})));return s.a.useEffect((()=>{!async function(){if(B){const e=await B.eth.getBlockNumber();o(e)}}()}),[B]),s.a.useEffect((()=>{console.log("erc20",A),A&&(console.log("get balance"),async function(){console.log("erc20",null===A||void 0===A?void 0:A.options.address);const t=await(null===A||void 0===A?void 0:A.methods.balanceOf(e).call()),n=await(null===A||void 0===A?void 0:A.methods.decimals().call());console.log("balance",t),console.log("decimals",n),g(t),x(h.a.utils.toNumber(n))}())}),[A]),s.a.useEffect((()=>{!async function(){if(console.log(),M&&e){const t=await(null===M||void 0===M?void 0:M.getBalance(e));console.log("fetchCkbBalance",t),u(t.toBigInt());const n=await v.getLayer2DepositAddress(B,e);S(n.toCKBAddress().toString())}}()}),[e,M,B]),s.a.useEffect((()=>{n&&async function(){console.log("erc20",null===A||void 0===A?void 0:A.options.address);const t=await(null===A||void 0===A?void 0:A.methods.balanceOf(e).call()),n=await(null===A||void 0===A?void 0:A.methods.decimals().call());console.log("balance",t),console.log("decimals",n),g(t),x(h.a.utils.toNumber(n))}()}),[n]),Object(r.jsxs)(r.Fragment,{children:[Object(r.jsx)("div",{style:{display:"flex"},children:Object(r.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[Object(r.jsx)("h1",{children:"Wrapped CKB on Godwoken Testnet"}),Object(r.jsx)("br",{}),Object(r.jsx)("br",{}),Object(r.jsx)(d,{onConnect:e=>{console.log("on connect"),t(e)}}),Object(r.jsx)("br",{}),Object(r.jsxs)("div",{children:["Account: ",e||void 0]}),Object(r.jsxs)("div",{style:{marginTop:16,marginBottom:16},children:["Godwoken Testnet balances:",Object(r.jsxs)("div",{style:{marginBottom:8,marginTop:8},children:["CKB Balance: ",null===i||void 0===i?void 0:i.toString()," Shannons"]}),Object(r.jsxs)("div",{style:{marginBottom:8},children:["wCKB Balance: ",m," Shannons"]}),Object(r.jsx)(p,{label:"Deposit CKB to get wCKB",value:k,onClick:async()=>{if(console.log("deposit"),j){const t=h.a.utils.toBN(k).mul(h.a.utils.toBN(10).pow(h.a.utils.toBN(j)));console.log("deposit amount",t.toString());const n=await(null===A||void 0===A?void 0:A.methods.deposit().send({from:e,value:t}));console.log("transaction hash",n),l(n);const a=await(null===A||void 0===A?void 0:A.methods.balanceOf(e).call());console.log("balance",a)}},onChange:e=>O(e)}),"The above value is in CKB unit (not in Shannons). Refresh the page after sending transaction."]})]})}),Object(r.jsx)("br",{}),Object(r.jsx)("br",{}),Object(r.jsxs)("div",{style:{maxWidth:"60%",wordWrap:"break-word"},children:["Layer 2 deposit address: ",C,Object(r.jsx)("br",{}),Object(r.jsx)("br",{}),"You can paste above address in ",Object(r.jsx)("a",{href:"https://faucet.nervos.org/",children:"https://faucet.nervos.org/"})," to get CKB on Layer 2."]})]})};var j=e=>{e&&e instanceof Function&&n.e(3).then(n.bind(null,882)).then((t=>{let{getCLS:n,getFID:a,getFCP:s,getLCP:o,getTTFB:c}=t;n(e),a(e),s(e),o(e),c(e)}))};c.a.render(Object(r.jsx)(s.a.StrictMode,{children:Object(r.jsx)(g,{})}),document.getElementById("root")),j()}},[[868,1,2]]]);
//# sourceMappingURL=main.cf54a840.chunk.js.map