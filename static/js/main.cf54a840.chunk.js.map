{"version":3,"sources":["metamask/types.ts","metamask/containers/ConnectButton.tsx","components/InputField.tsx","polyjuice/hooks.ts","App.tsx","contracts/hooks.ts","reportWebVitals.ts","index.tsx"],"names":["MetamaskActions","ConnectButton","onConnect","buttonText","setButtonText","React","useState","isDisabled","setDisabled","accounts","setAccounts","onboarding","useRef","handleRequestAccount","connectedAccount","useEffect","current","MetaMaskOnboarding","console","log","isMetaMaskInstalled","length","stopOnboarding","window","ethereum","request","method","requestAccounts","then","on","accountsChanged","off","disabled","onClick","startOnboarding","InputField","label","onChange","value","placeholder","style","display","border","justifyContent","padding","event","Number","target","addressTranslator","AddressTranslator","App","connectedAccountAddress","setConnectedAccountAddress","blockNumber","setBlockNumber","latestTransactionHash","setLatestTransactionHash","ckbBalance","setCkbBalance","tokenBalance","setTokenBalance","decimals","setDecimals","transferValue","setTransferValue","depositAddress","setDepositAddress","web3","setWeb3","options","timeout","clientConfig","maxReceivedFrameSize","maxReceivedMessageSize","keepalive","keepaliveInterval","reconnect","auto","delay","maxAttempts","onTimeout","provider","PolyjuiceWebsocketProvider","config","nervos","godwoken","wsUrl","rollupTypeHash","ethAccountLockCodeHash","web3Url","rpcUrl","setMultiAbi","ERC20_JSON","abi","Web3","useWeb3","ethers","setEthers","EthersPolyjuiceWebsocketProvider","useEthers","erc20","erc20Address","setERC20","eth","Contract","useERC20Contract","subscribe","async","error","result","number","getBlockNumber","address","balance","methods","balanceOf","call","utils","toNumber","listenBalance","getBalance","toBigInt","newDepositAddress","getLayer2DepositAddress","toCKBAddress","toString","fetchCkbBalance","flexDirection","undefined","marginTop","marginBottom","weiTransferValue","toBN","mul","pow","transactionHash","deposit","send","from","maxWidth","wordWrap","href","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.cf54a840.chunk.js","sourcesContent":["export enum MetamaskActions {\n    requestAccounts = 'eth_requestAccounts',\n    requestWallet = 'wallet_requestPermissions',\n    watchAsset = 'wallet_watchAsset',\n    switchNetwork = 'wallet_switchEthereumChain',\n    accountsChanged = 'accountsChanged',\n  }\n  ","import MetaMaskOnboarding from '@metamask/onboarding';\nimport React from 'react';\n\nimport { MetamaskActions } from '../types'\n\nconst ONBOARD_TEXT = 'Click here to install MetaMask!';\nconst CONNECT_TEXT = 'Connect';\nconst CONNECTED_TEXT = 'Connected';\n\ninterface IConnectButtonProps {\n    onConnect: (connectedAccountAddress: string) => void\n}\n\nexport const ConnectButton: React.FC<IConnectButtonProps> = ({ onConnect }) => {\n    const [buttonText, setButtonText] = React.useState(ONBOARD_TEXT);\n    const [isDisabled, setDisabled] = React.useState(false);\n    const [accounts, setAccounts] = React.useState<string[]>([]);\n    const onboarding = React.useRef<MetaMaskOnboarding>();\n\n    const handleRequestAccount = (accounts: string[]) => {\n        const [connectedAccount] = accounts\n        setAccounts(accounts);\n\n        onConnect(connectedAccount)\n    }\n\n    React.useEffect(() => {\n        if (!onboarding.current) {\n            onboarding.current = new MetaMaskOnboarding();\n        }\n    }, []);\n\n    React.useEffect(() => {\n        console.log('effect')\n        if (MetaMaskOnboarding.isMetaMaskInstalled()) {\n            console.log('metamask installed')\n            if (accounts.length > 0) {\n                console.log('connect')\n                setButtonText(CONNECTED_TEXT);\n                setDisabled(true);\n                onboarding.current?.stopOnboarding();\n            } else {\n                console.log('connected')\n                setButtonText(CONNECT_TEXT);\n                setDisabled(false);\n            }\n        }\n    }, [accounts]);\n\n    React.useEffect(() => {\n        if (MetaMaskOnboarding.isMetaMaskInstalled()) {\n            window.ethereum\n                .request({ method: MetamaskActions.requestAccounts })\n                .then(handleRequestAccount);\n            window.ethereum.on(MetamaskActions.accountsChanged, handleRequestAccount);\n            return () => {\n                window.ethereum.off(MetamaskActions.accountsChanged, handleRequestAccount);\n            };\n        }\n    }, []);\n\n    const onClick = () => {\n        if (MetaMaskOnboarding.isMetaMaskInstalled()) {\n            window.ethereum\n                .request({ method: MetamaskActions.requestAccounts })\n                .then((accounts: string[]) => handleRequestAccount(accounts));\n        } else {\n            onboarding.current?.startOnboarding();\n        }\n    };\n\n    return (\n        <button disabled={isDisabled} onClick={onClick}>\n            {buttonText}\n        </button>\n    );\n}","import React from 'react';\n\n\ninterface IInputFieldProps {\n    label: string,\n    onChange: (value: number) => void\n    onClick: () =>  void\n    value: number\n    placeholder?: string\n}\n\nexport const InputField: React.FC<IInputFieldProps> = ({ label, onClick, onChange, value, placeholder }) => {\n\n    const handleInputChange = (event: React.ChangeEvent<HTMLInputElement>) => {\n        const value = Number(event.target.value)\n        onChange(value)\n    }\n\n    return (\n        <div style={{ display: 'flex', border: '1px solid black', justifyContent: 'space-between',padding: 8 }}>\n            <input onChange={handleInputChange} value={value} placeholder={placeholder} />\n            <button onClick={onClick}>\n                {label}\n            </button>\n        </div>\n    );\n}","import { useEffect, useState } from 'react'\nimport { WebsocketProvider } from 'web3-providers-ws'\n\nimport { PolyjuiceWebsocketProvider } from \"@polyjuice-provider/web3\"\nimport { PolyjuiceWebsocketProvider as EthersPolyjuiceWebsocketProvider } from \"@polyjuice-provider/ethers\"\nimport config from \"../godwoken.config.json\"\nimport Web3 from 'web3'\nimport { providers } from 'ethers'\nimport ERC20_JSON from '../contracts/abi/ERC20.json'\n\nexport const useWeb3 = (connectedAccountAddress: string | null) => {\n    const [web3, setWeb3] = useState<Web3 | null>(null)\n\n    const options = {\n        timeout: 30000, // ms\n\n        clientConfig: {\n          // Useful if requests are large\n          maxReceivedFrameSize: 100000000,   // bytes - default: 1MiB\n          maxReceivedMessageSize: 100000000, // bytes - default: 8MiB\n    \n          // Useful to keep a connection alive\n          keepalive: true,\n          keepaliveInterval: 60000 // ms\n        },\n    \n        // Enable auto reconnection\n        reconnect: {\n            auto: true,\n            delay: 5000, // ms\n            maxAttempts: 5,\n            onTimeout: false\n        }\n    };\n\n    useEffect(() => {\n        if (connectedAccountAddress) {\n            const provider = new PolyjuiceWebsocketProvider(\n                config.nervos.godwoken.wsUrl, {\n                rollupTypeHash: config.nervos.rollupTypeHash,\n                ethAccountLockCodeHash: config.nervos.ethAccountLockCodeHash,\n                web3Url: config.nervos.godwoken.rpcUrl\n            }, options)\n\n            provider.setMultiAbi([ERC20_JSON.abi as any]);\n\n            const web3 = new Web3(provider as WebsocketProvider)\n            setWeb3(web3)\n        }\n    }, [connectedAccountAddress])\n\n    return web3\n}\n\nexport const useEthers = (connectedAccountAddress: string | null) => {\n    const [ethers, setEthers] = useState<providers.WebSocketProvider | null>(null)\n\n    const options = {\n        timeout: 30000, // ms\n\n        clientConfig: {\n          // Useful if requests are large\n          maxReceivedFrameSize: 100000000,   // bytes - default: 1MiB\n          maxReceivedMessageSize: 100000000, // bytes - default: 8MiB\n    \n          // Useful to keep a connection alive\n          keepalive: true,\n          keepaliveInterval: 60000 // ms\n        },\n    \n        // Enable auto reconnection\n        reconnect: {\n            auto: true,\n            delay: 5000, // ms\n            maxAttempts: 5,\n            onTimeout: false\n        }\n    };\n\n    useEffect(() => {\n        if (connectedAccountAddress) {\n            const provider = new EthersPolyjuiceWebsocketProvider({\n                rollupTypeHash: config.nervos.rollupTypeHash,\n                ethAccountLockCodeHash: config.nervos.ethAccountLockCodeHash,\n                web3Url: config.nervos.godwoken.rpcUrl\n            }, config.nervos.godwoken.wsUrl)\n            provider.on('block', () => console.log('block new'))\n            const ethers = provider as providers.WebSocketProvider\n            setEthers(ethers)\n        }\n    }, [connectedAccountAddress])\n\n    return ethers\n}","import React from 'react'\nimport { AddressTranslator } from 'nervos-godwoken-integration';\n\nimport { listenBlocks } from './contracts/hooks';\n\nimport { ConnectButton } from './metamask/containers/ConnectButton'\nimport { InputField } from './components/InputField'\nimport { useEthers, useWeb3 } from './polyjuice/hooks'\n\nimport Web3 from 'web3'\nimport { useERC20Contract } from './contracts/hooks'\n\nconst addressTranslator = new AddressTranslator();\n\nconst App: React.FC = () => {\n  const [connectedAccountAddress, setConnectedAccountAddress] = React.useState<string | null>(null);\n  const [blockNumber, setBlockNumber] = React.useState<number | null>(null);\n  const [latestTransactionHash, setLatestTransactionHash] = React.useState<string | null>(null)\n  const [ckbBalance, setCkbBalance] = React.useState<BigInt | null>(null);\n  const [tokenBalance, setTokenBalance] = React.useState<BigInt | null>(null);\n  const [decimals, setDecimals] = React.useState<number | null>(null);\n  const [transferValue, setTransferValue] = React.useState<number>(0)\n  const [depositAddress, setDepositAddress] = React.useState<string | null>(null)\n\n  const web3 = useWeb3(connectedAccountAddress)\n  const ethers = useEthers(connectedAccountAddress)\n\n  const wCKBAddress = '0x0815b0d4e58c8e707a85e774c37cab65480f66e9'\n  const erc20 = useERC20Contract(wCKBAddress, web3)\n\n  if (web3) {\n    web3.eth\n    .subscribe('newBlockHeaders', async (error, result) => {\n        if (!error) {\n          setBlockNumber(result.number)\n        } else {\n          console.error(error)\n        }\n    })\n  }\n\n  if (ethers) {\n    console.log('ethers', ethers)\n    ethers.on('block', (blockNumber: number) => {\n      console.log('ethers New Block from ethers:', blockNumber)\n    })\n  }\n\n  const deposit = async () => {\n    console.log('deposit')\n    if (decimals) {\n      const weiTransferValue = Web3.utils.toBN(transferValue).mul(Web3.utils.toBN(10).pow(Web3.utils.toBN(decimals)))\n      console.log('deposit amount', weiTransferValue.toString())\n      const transactionHash = await erc20?.methods.deposit().send({ from: connectedAccountAddress, value: weiTransferValue })\n      console.log('transaction hash', transactionHash)\n      setLatestTransactionHash(transactionHash)\n\n      const balance = await erc20?.methods\n        .balanceOf(connectedAccountAddress)\n        .call()\n      console.log('balance', balance)\n    }\n  }\n\n  React.useEffect(() => {\n    async function getBlockNumber() {\n      if(web3) {\n        const blockNumber = await web3.eth.getBlockNumber()\n\n        setBlockNumber(blockNumber)\n      }\n    }\n\n    getBlockNumber()\n  }, [web3])\n\n  React.useEffect(() => {\n    async function listenBalance() {\n      console.log('erc20', erc20?.options.address)\n      const balance = await erc20?.methods\n        .balanceOf(connectedAccountAddress)\n        .call()\n\n      const decimals = await erc20?.methods.decimals().call()\n      console.log('balance', balance)\n      console.log('decimals', decimals)\n\n      setTokenBalance(balance)\n      setDecimals(Web3.utils.toNumber(decimals))\n    }\n    console.log('erc20', erc20)\n\n    if (erc20) {\n      console.log('get balance')\n      listenBalance()\n    }\n  }, [erc20])\n\n  React.useEffect(() => {\n    async function fetchCkbBalance() {\n      console.log();\n      if (ethers && connectedAccountAddress) {\n        const ckbBalance = await ethers?.getBalance(connectedAccountAddress);\n        console.log('fetchCkbBalance', ckbBalance);\n        setCkbBalance(ckbBalance.toBigInt());\n\n        const newDepositAddress = await addressTranslator.getLayer2DepositAddress(web3, connectedAccountAddress);\n        // console.log('ckb addr deposit', newDepositAddress.toCKBAddress().toString());\n        setDepositAddress(newDepositAddress.toCKBAddress().toString());\n      }\n    }\n\n    fetchCkbBalance();\n  }, [connectedAccountAddress, ethers, web3]);\n  \n  // React.useEffect(() => {\n  //   async function listenBalance() {\n  //     console.log('erc20', erc20?.options.address)\n  //     const balance = await erc20?.methods\n  //       .balanceOf(polyConnectedAccountAddress)\n  //       .call()\n\n  //     const decimals = await erc20?.methods.decimals().call()\n  //     console.log('balance', balance)\n  //     console.log('decimals', decimals)\n\n  //     setBalance(balance)\n  //     setDecimals(Web3.utils.toNumber(decimals))\n  //   }\n  //   console.log('erc20', erc20)\n\n  //   if (latestTransactionHash) {\n  //     console.log('get balance')\n  //     listenBalance()\n  //   }\n  // }, [latestTransactionHash])\n\n  React.useEffect(() => {\n    async function listenBalance() {\n      console.log('erc20', erc20?.options.address)\n      const balance = await erc20?.methods\n        .balanceOf(connectedAccountAddress)\n        .call()\n\n      const decimals = await erc20?.methods.decimals().call()\n      console.log('balance', balance)\n      console.log('decimals', decimals)\n\n      setTokenBalance(balance)\n      setDecimals(Web3.utils.toNumber(decimals))\n    }\n\n    if (blockNumber) {\n      listenBalance()\n    }\n  }, [blockNumber])\n  // listenBlocks(web3)\n\n  return (<>\n    <div style={{ display: 'flex'}}>\n      \n      <div style={{ display: 'flex', flexDirection: 'column'}}>\n      <h1>Wrapped CKB on Godwoken Testnet</h1>\n      <br/><br/>\n\n        <ConnectButton\n          onConnect={\n            (connectedAccountAddress) => {\n              console.log('on connect')\n              setConnectedAccountAddress(connectedAccountAddress)\n            }\n          }\n        />\n        <br/>\n        <div>\n          Account: {connectedAccountAddress ? connectedAccountAddress : undefined}\n        </div>\n        <div style={{ marginTop: 16, marginBottom: 16 }}>\n          Godwoken Testnet balances:\n          <div style={{ marginBottom: 8, marginTop: 8 }}>CKB Balance: {ckbBalance?.toString()} Shannons</div>\n          <div style={{ marginBottom: 8 }}>wCKB Balance: {tokenBalance} Shannons</div>\n          <InputField\n            label=\"Deposit CKB to get wCKB\"\n            value={transferValue}\n            onClick={deposit}\n            onChange={(value) => setTransferValue(value)}\n          />\n          The above value is in CKB unit (not in Shannons). Refresh the page after sending transaction.\n        </div>\n      </div>\n    </div>\n    <br/>\n    <br/>\n    <div style={{ maxWidth: '60%', wordWrap: 'break-word' }}>\n    Layer 2 deposit address: {depositAddress}\n    <br/><br />\n    You can paste above address in <a href=\"https://faucet.nervos.org/\">https://faucet.nervos.org/</a> to get CKB on Layer 2.\n    </div>\n  </>\n  );\n}\n\nexport default App;\n","import ERC20_JSON from './abi/ERC20.json'\n\nimport { useEffect, useState } from 'react'\n\n\nimport Web3 from 'web3';\nimport { Contract } from 'web3-eth-contract'\nimport { AbiItem } from 'web3-utils'\n\nexport const useERC20Contract = (erc20Address: string, web3: Web3 | null) => {\n    const [erc20, setERC20] = useState<Contract | null>()\n\n    useEffect(() => {\n        if (web3) {\n            const erc20 = new web3.eth.Contract(ERC20_JSON.abi as AbiItem[], erc20Address)\n\n            setERC20(erc20)\n\n            console.log('erc20 connected', erc20)\n        }\n    }, [erc20Address, web3])\n\n    return erc20\n}\n\nexport const listenBlocks = (web3: Web3 | null) => {\n    console.log('listen blocks')\n\n    if (web3) {\n        console.log('subscribe block')\n        web3.eth\n            .subscribe('newBlockHeaders', (error, result) => {\n                if (!error) {\n                    console.log(result)\n                }\n                console.error(error)\n            })\n            .on(\"connected\", function(subscriptionId){\n                console.log('connected', subscriptionId);\n            })\n            .on(\"data\", function(blockHeader){\n                console.log('block header', blockHeader);\n            })\n            .on(\"error\", console.error);\n    }\n}","import { ReportHandler } from 'web-vitals';\n\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}